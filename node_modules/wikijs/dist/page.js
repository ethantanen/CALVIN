'use strict';var _slicedToArray=function(){function c(d,e){var f=[],g=!0,h=!1,j=void 0;try{for(var l,k=d[Symbol.iterator]();!(g=(l=k.next()).done)&&(f.push(l.value),!(e&&f.length===e));g=!0);}catch(m){h=!0,j=m}finally{try{!g&&k['return']&&k['return']()}finally{if(h)throw j}}return f}return function(d,e){if(Array.isArray(d))return d;if(Symbol.iterator in Object(d))return c(d,e);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}();Object.defineProperty(exports,'__esModule',{value:!0});exports.default=wikiPage;var _util=require('./util'),_infoboxParser=require('infobox-parser'),_infoboxParser2=_interopRequireDefault(_infoboxParser),_coordinates=require('./coordinates');function _interopRequireDefault(c){return c&&c.__esModule?c:{default:c}}function _toConsumableArray(c){if(Array.isArray(c)){for(var d=0,e=Array(c.length);d<c.length;d++)e[d]=c[d];return e}return Array.from(c)}var getFileName=function(c){if(c){if(-1!==c.indexOf(':')){var d=c.split(':'),e=_slicedToArray(d,2),f=e[1];return f}return c}};function wikiPage(c,d){function h(){return(0,_util.api)(d,{generator:'images',gimlimit:'max',prop:'imageinfo',iiprop:'url',titles:u.title}).then(function(w){return w.query?Object.keys(w.query.pages).map(function(x){return w.query.pages[x]}):[]})}function p(){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',rvsection:0,titles:u.title}).then(function(w){return w.query.pages[u.pageid].revisions[0]['*']})}function q(w){return p().then(function(x){return(0,_infoboxParser2.default)(x,d.parser).general}).then(function(x){return w?x.hasOwnProperty(w)?x[w]:void 0:x})}var u=c;return{raw:u,html:function(){return(0,_util.api)(d,{prop:'revisions',rvprop:'content',rvlimit:1,rvparse:'',titles:u.title}).then(function(w){return w.query.pages[u.pageid].revisions[0]['*']})},content:function(){return(0,_util.api)(d,{prop:'extracts',explaintext:'',titles:u.title}).then(function(w){return w.query.pages[u.pageid].extract})},summary:function(){return(0,_util.api)(d,{prop:'extracts',explaintext:'',exintro:'',titles:u.title}).then(function(w){return w.query.pages[u.pageid].extract})},images:function(){return h().then(function(w){return w.map(function(x){return x.imageinfo}).reduce(function(x,y){return[].concat(_toConsumableArray(x),_toConsumableArray(y))},[]).map(function(x){return x.url})})},references:function(){return(0,_util.api)(d,{prop:'extlinks',ellimit:'max',titles:u.title}).then(function(w){return w.query.pages[u.pageid].extlinks.map(function(x){return x['*']})})},links:function(){var w=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,x=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,y=(0,_util.pagination)(d,{prop:'links',plnamespace:0,pllimit:x,titles:u.title},function(z){return z.query.pages[u.pageid].links.map(function(A){return A.title})});return w?(0,_util.aggregatePagination)(y):y},categories:function(){var w=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,x=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,y=(0,_util.pagination)(d,{prop:'categories',pllimit:x,titles:u.title},function(z){return z.query.pages[u.pageid].categories.map(function(A){return A.title})});return w?(0,_util.aggregatePagination)(y):y},coordinates:function(){return(0,_util.api)(d,{prop:'coordinates',titles:u.title}).then(function(w){var x=w.query.pages[u.pageid];return x.coordinates?x.coordinates[0]:q().then(function(y){return(0,_coordinates.parseCoordinates)(y)})})},info:q,backlinks:function(){var w=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,x=1<arguments.length&&arguments[1]!==void 0?arguments[1]:100,y=(0,_util.pagination)(d,{list:'backlinks',bllimit:x,bltitle:u.title},function(z){return z.query.backlinks.map(function(A){return A.title})});return w?(0,_util.aggregatePagination)(y):y},rawImages:h,mainImage:function(){return Promise.all([h(),q()]).then(function(w){var x=_slicedToArray(w,2),y=x[0],z=x[1],A=getFileName(z.image||z.bildname||z.imagen||z.Immagine||z.badge||z.logo);if(!A)return p().then(function(C){if(y.length){y.sort(function(E,F){return C.indexOf(F.title)-C.indexOf(E.title)});var D=y[0];return 0<D.imageinfo.length?D.imageinfo[0].url:void 0}});var B=y.find(function(C){var D=C.title,E=getFileName(D);return E===A||E.replace(/\s/g,'_')===A});return B&&0<B.imageinfo.length?B.imageinfo[0].url:void 0})},langlinks:function(){return(0,_util.api)(d,{prop:'langlinks',lllimit:'max',titles:u.title}).then(function(w){return w.query.pages[u.pageid].langlinks.map(function(x){return{lang:x.lang,title:x['*']}})})},rawInfo:p,fullInfo:function(){return p().then(function(w){return(0,_infoboxParser2.default)(w,d.parser)})}}}
//# sourceMappingURL=page.js.map